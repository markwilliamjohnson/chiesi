<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AREA Framework Coach — Anticipation → AI Prompts</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#111a33; --text:#e9ecff; --muted:#b9c0ff; --faint:#7e89d6;
      --accent:#7aa2ff; --accent2:#67e8f9; --danger:#fb7185; --ok:#34d399;
      --border:rgba(255,255,255,.10); --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:18px; --radius2:14px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text); min-height:100vh;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(122,162,255,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(103,232,249,.18), transparent 55%),
        radial-gradient(900px 700px at 50% 120%, rgba(52,211,153,.10), transparent 55%),
        var(--bg);
    }
    header{padding:28px 18px 8px; max-width:1040px; margin:0 auto}
    h1{margin:0; font-size:clamp(22px,3vw,34px); letter-spacing:-.02em}
    .subtitle{margin:8px 0 0; color:var(--muted); line-height:1.45; max-width:80ch}
    main{max-width:1040px; margin:0 auto; padding:18px; display:grid; grid-template-columns:340px 1fr; gap:18px}
    @media (max-width:920px){main{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border); box-shadow:var(--shadow); border-radius:var(--radius); overflow:hidden;
    }
    .card .hd{padding:16px 16px 12px; border-bottom:1px solid var(--border); background:rgba(0,0,0,.12)}
    .card .bd{padding:16px}
    .title{display:flex; flex-wrap:wrap; gap:10px 14px; align-items:baseline; justify-content:space-between}
    .pill{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); background:rgba(0,0,0,.18); white-space:nowrap}
    .pill.ok{color:var(--ok); border-color:rgba(52,211,153,.35)}
    .pill.warn{color:#fde68a; border-color:rgba(253,230,138,.25)}
    .mono{font-family:var(--mono)}
    .small{font-size:13px; color:var(--muted); line-height:1.45}
    .steps{display:flex; flex-direction:column; gap:10px; padding:8px}
    .stepBtn{
      width:100%; text-align:left; border:1px solid var(--border); background:rgba(15,23,48,.55);
      color:var(--text); border-radius:var(--radius2); padding:12px; cursor:pointer;
      transition:transform .05s ease, background .2s ease;
    }
    .stepBtn:hover{background:rgba(15,23,48,.8)}
    .stepBtn:active{transform:translateY(1px)}
    .stepBtn[aria-current="step"]{outline:2px solid rgba(122,162,255,.45); background:rgba(122,162,255,.14)}
    .stepTop{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .progressWrap{padding:0 8px 12px}
    .bar{height:10px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid var(--border); overflow:hidden}
    .bar>div{height:100%; width:0%; background:linear-gradient(90deg, rgba(122,162,255,.95), rgba(103,232,249,.9)); transition:width .35s ease}
    .kbd{font-family:var(--mono); font-size:12px; padding:2px 6px; border-radius:6px; border:1px solid var(--border); background:rgba(0,0,0,.25); color:var(--muted)}
    .callout{border:1px solid var(--border); background:rgba(0,0,0,.14); border-radius:var(--radius2); padding:12px; margin:12px 0}
    .callout strong{color:var(--accent2)}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:700px){.grid2{grid-template-columns:1fr}}
    label{display:block; font-weight:650; margin:10px 0 6px}
    input[type="text"], textarea, select{
      width:100%; border:1px solid var(--border); background:rgba(15,23,48,.55); color:var(--text);
      border-radius:14px; padding:10px 12px; font-size:14px; outline:none;
    }
    textarea{min-height:110px; resize:vertical}
    input[type="text"]:focus, textarea:focus, select:focus{
      border-color:rgba(122,162,255,.55); box-shadow:0 0 0 4px rgba(122,162,255,.12);
    }
    .hint{margin-top:6px; font-size:12.5px; color:var(--faint); line-height:1.4}
    .btnRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; align-items:center; justify-content:space-between}
    .btnGroup{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    button{
      border:1px solid var(--border); background:rgba(15,23,48,.65); color:var(--text);
      border-radius:999px; padding:10px 14px; cursor:pointer;
      transition:transform .05s ease, background .2s ease, border-color .2s ease;
      font-weight:650;
    }
    button:hover{background:rgba(15,23,48,.9); border-color:rgba(255,255,255,.18)}
    button:active{transform:translateY(1px)}
    button.primary{
      background:linear-gradient(90deg, rgba(122,162,255,.95), rgba(103,232,249,.85));
      color:#081027; border-color:rgba(103,232,249,.35);
    }
    button.danger{border-color:rgba(251,113,133,.35); color:#ffd3da}
    .qBlock{border:1px solid var(--border); background:rgba(15,23,48,.35); border-radius:var(--radius2); padding:12px; margin:12px 0}
    .qTitle{margin:0 0 6px; font-size:15px; letter-spacing:-.01em}
    .qMeta{font-size:12.5px; color:var(--muted); line-height:1.4; margin:0 0 10px}
    .tagRow{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 0}
    .tag{font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid var(--border); background:rgba(0,0,0,.18); color:var(--muted)}
    .status{display:flex; align-items:center; gap:10px; justify-content:space-between; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:rgba(0,0,0,.16)}
    .status b{color:var(--accent2)}
    .foot{margin-top:10px; font-size:12px; color:var(--faint); line-height:1.4}
    .promptBox{
      border:1px solid var(--border);
      background:rgba(0,0,0,.22);
      border-radius:14px;
      padding:12px;
      font-family:var(--mono);
      font-size:12.5px;
      line-height:1.5;
      white-space:pre-wrap;
      word-break:break-word;
      max-height:360px;
      overflow:auto;
    }
  </style>
</head>
<body>
<header>
  <div class="title">
    <h1>AREA Framework Coach</h1>
    <div class="pill mono" id="saveIndicator" title="Autosave status">saved</div>
  </div>
  <p class="subtitle">
    Describe a software project, reflect using <b>AREA</b>, and then generate tailored <b>GenAI prompts</b>
    (spec refinement, impact diagram, and an interactive HTML/JS illustration).
  </p>
</header>

<main>
  <section class="card" aria-label="Steps navigation">
    <div class="hd">
      <div class="status">
        <div>
          <div class="small">Progress</div>
          <div><b id="pct">0%</b> complete</div>
        </div>
        <div class="kbd" title="Keyboard tip">Alt + ← / →</div>
      </div>
    </div>
    <div class="bd">
      <div class="progressWrap">
        <div class="bar" aria-label="Completion bar"><div id="barFill"></div></div>
        <div class="foot" id="progressNote"></div>
      </div>
      <div class="steps" role="list" id="stepList"></div>

      <div class="callout">
        <div class="small">
          Tip: write assumptions and uncertainties. That’s often where the best AI feedback comes from.
        </div>
      </div>

      <button class="danger" id="resetBtn" title="Clears saved data for this app">Reset all</button>
      <div class="foot">Data stays in your browser (<span class="mono">localStorage</span>).</div>
    </div>
  </section>

  <section class="card" aria-label="Step content">
    <div class="hd">
      <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
        <div>
          <div class="small" id="stepKicker">Step</div>
          <div style="font-size:20px; font-weight:800; letter-spacing:-.01em;" id="stepTitle">—</div>
        </div>
        <div class="pill" id="stepBadge">—</div>
      </div>
    </div>
    <div class="bd" id="content"></div>
  </section>
</main>

<script>
(() => {
  const STORAGE_KEY = "area-coach-v2-prompts";

  const model = {
    meta: {
      projectName: "",
      projectOneLiner: "",
      projectStage: "idea",
      stack: "",
      users: "",
      constraints: "",
      dateStarted: new Date().toISOString()
    },
    anticipate: {
      intendedOutcomes: "",
      stakeholders: "",
      impacts: "",
      risksFailures: "",
      misuseAbuse: "",
      dataPrivacySecurity: "",
      fairnessInclusion: "",
      environmentalSocial: "",
      legalRegulatory: "",
      uncertaintiesAssumptions: "",
      alternatives: "",
      mitigations: "",
      goNoGo: ""
    }
  };

  const steps = [
    { id:"welcome", title:"Welcome & how this works", badge:"Start",
      render: renderWelcome,
      isComplete: () => model.meta.projectName.trim().length > 0
    },
    { id:"project", title:"Your project (context)", badge:"Setup",
      render: renderProject,
      isComplete: () =>
        model.meta.projectName.trim().length > 0 &&
        model.meta.projectOneLiner.trim().length > 0 &&
        model.meta.users.trim().length > 0
    },
    { id:"anticipate", title:"Anticipation — critical questions", badge:"Deep dive",
      render: renderAnticipation,
      isComplete: () => completionAnticipation() >= 0.65
    },
    { id:"prompts", title:"Generate AI prompts", badge:"Outputs",
      render: renderPrompts,
      isComplete: () => true
    }
  ];

  let currentStepIndex = 0;

  const $ = (sel) => document.querySelector(sel);
  const stepList = $("#stepList");
  const content = $("#content");
  const stepTitle = $("#stepTitle");
  const stepKicker = $("#stepKicker");
  const stepBadge = $("#stepBadge");
  const saveIndicator = $("#saveIndicator");
  const pct = $("#pct");
  const barFill = $("#barFill");
  const progressNote = $("#progressNote");

  function deepAssign(target, src) {
    if (!src || typeof src !== "object") return;
    for (const k of Object.keys(src)) {
      if (src[k] && typeof src[k] === "object" && !Array.isArray(src[k])) {
        if (!target[k]) target[k] = {};
        deepAssign(target[k], src[k]);
      } else if (k in target) {
        target[k] = src[k];
      }
    }
  }

  function load() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      deepAssign(model, JSON.parse(raw));
    } catch (e) { console.warn("Load failed:", e); }
  }
  function save() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(model, null, 2));
      flashSaved();
    } catch (e) {
      console.warn("Save failed:", e);
      saveIndicator.textContent = "save failed";
      saveIndicator.style.borderColor = "rgba(251,113,133,.35)";
      saveIndicator.style.color = "#ffd3da";
    }
  }
  let saveTimer = null;
  function scheduleSave() {
    saveIndicator.textContent = "saving…";
    saveIndicator.className = "pill mono";
    if (saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(save, 250);
  }
  function flashSaved() {
    saveIndicator.textContent = "saved";
    saveIndicator.className = "pill mono";
    saveIndicator.style.borderColor = "rgba(52,211,153,.35)";
    saveIndicator.style.color = "var(--ok)";
    setTimeout(() => { saveIndicator.style.borderColor = ""; saveIndicator.style.color = ""; }, 650);
  }

  function completionAnticipation() {
    const a = model.anticipate;
    const fields = [
      a.intendedOutcomes, a.stakeholders, a.impacts, a.risksFailures, a.misuseAbuse,
      a.dataPrivacySecurity, a.fairnessInclusion, a.environmentalSocial,
      a.uncertaintiesAssumptions, a.mitigations, a.goNoGo
    ];
    const filled = fields.filter(v => (v || "").trim().length >= 20).length;
    return filled / fields.length;
  }

  function overallCompletion() {
    const completeCount = steps.filter(s => s.isComplete()).length;
    return completeCount / steps.length;
  }

  function updateProgressUI() {
    const ratio = overallCompletion();
    const percent = Math.round(ratio * 100);
    pct.textContent = `${percent}%`;
    barFill.style.width = `${percent}%`;
    const next = steps.find(s => !s.isComplete());
    progressNote.textContent = next ? `Next: ${next.title}` : `All steps available — export prompts and iterate.`;
  }

  function buildNav() {
    stepList.innerHTML = "";
    steps.forEach((s, i) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "stepBtn";
      btn.setAttribute("role","listitem");
      btn.onclick = () => goTo(i);

      const top = document.createElement("div");
      top.className = "stepTop";

      const left = document.createElement("div");
      left.style.display="flex";
      left.style.flexDirection="column";
      left.style.gap="3px";

      const t = document.createElement("div");
      t.style.fontWeight="850";
      t.style.letterSpacing="-.01em";
      t.textContent = s.title;

      const small = document.createElement("div");
      small.className="small";
      small.textContent = s.badge;

      left.appendChild(t);
      left.appendChild(small);

      const pill = document.createElement("div");
      pill.className = "pill " + (s.isComplete() ? "ok" : "warn");
      pill.textContent = s.isComplete() ? "ready" : "in progress";

      top.appendChild(left);
      top.appendChild(pill);

      btn.appendChild(top);
      if (i === currentStepIndex) btn.setAttribute("aria-current","step");
      stepList.appendChild(btn);
    });
  }

  function goTo(i){ currentStepIndex = Math.max(0, Math.min(steps.length-1, i)); render(); }
  function next(){ goTo(currentStepIndex + 1); }
  function prev(){ goTo(currentStepIndex - 1); }

  window.addEventListener("keydown", (e) => {
    if (!e.altKey) return;
    if (e.key === "ArrowRight") { e.preventDefault(); next(); }
    if (e.key === "ArrowLeft") { e.preventDefault(); prev(); }
  });

  function h(tag, attrs={}, children=[]) {
    const el = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)) {
      if (k === "class") el.className = v;
      else if (k === "html") el.innerHTML = v;
      else if (k.startsWith("on") && typeof v === "function") el.addEventListener(k.slice(2), v);
      else el.setAttribute(k, v);
    }
    for (const c of children) el.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
    return el;
  }

  function fieldText({label, value, placeholder, onInput, hint}) {
    const wrap = h("div");
    wrap.appendChild(h("label", {}, [label]));
    const input = h("input", { type:"text", value: value || "", placeholder: placeholder || "" });
    input.addEventListener("input", (e) => onInput(e.target.value));
    wrap.appendChild(input);
    if (hint) wrap.appendChild(h("div", { class:"hint" }, [hint]));
    return wrap;
  }

  function fieldArea({label, value, placeholder, onInput, hint, minHeight}) {
    const wrap = h("div");
    wrap.appendChild(h("label", {}, [label]));
    const ta = h("textarea", { placeholder: placeholder || "" });
    if (minHeight) ta.style.minHeight = minHeight;
    ta.value = value || "";
    ta.addEventListener("input", (e) => onInput(e.target.value));
    wrap.appendChild(ta);
    if (hint) wrap.appendChild(h("div", { class:"hint" }, [hint]));
    return wrap;
  }

  function navButtons({showPrev=true, showNext=true, nextLabel="Next", prevLabel="Back"}) {
    const row = h("div", { class:"btnRow" });
    const left = h("div", { class:"btnGroup" });
    const right = h("div", { class:"btnGroup" });

    if (showPrev) left.appendChild(h("button", { type:"button", onclick: prev }, [prevLabel]));
    if (showNext) right.appendChild(h("button", { type:"button", class:"primary", onclick: next }, [nextLabel]));

    row.appendChild(left);
    row.appendChild(right);
    return row;
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
    }[m]));
  }

  /** ---------- Step: Welcome ---------- **/
  function renderWelcome(root){
    root.appendChild(h("div",{class:"callout"},[
      h("div",{class:"small", html:
        `<strong>Outcome:</strong> you’ll end with AI-ready prompt texts tailored to your project:
         (1) spec refinement, (2) diagram of system + impacts, (3) interactive HTML/JS illustration.`})
    ]));

    root.appendChild(fieldText({
      label:"Project name",
      value:model.meta.projectName,
      placeholder:"e.g., BugBuddy",
      onInput:(v)=>{ model.meta.projectName=v; scheduleSave(); buildNav(); updateProgressUI(); },
      hint:"Tip: choose a name you’ll recognize later."
    }));

    root.appendChild(h("div",{class:"callout"},[
      h("div",{class:"small", html:
        `<strong>Keyboard:</strong> <span class="kbd">Alt</span> + <span class="kbd">←</span>/<span class="kbd">→</span>`})
    ]));

    root.appendChild(navButtons({showPrev:false, nextLabel:"Set up the project"}));
  }

  /** ---------- Step: Project ---------- **/
  function renderProject(root){
    root.appendChild(h("p",{class:"small"},[
      "Make the project concrete. This will be embedded into the generated AI prompts."
    ]));

    const g = h("div",{class:"grid2"});
    g.appendChild(fieldText({
      label:"Project name",
      value:model.meta.projectName,
      placeholder:"Short name",
      onInput:(v)=>{ model.meta.projectName=v; scheduleSave(); buildNav(); updateProgressUI(); }
    }));

    const stageWrap = h("div");
    stageWrap.appendChild(h("label",{},["Project stage"]));
    const sel = h("select");
    [["idea","Idea / exploring"],["prototype","Prototype"],["mvp","MVP / first users"],["prod","In production"],["migration","Migration / rewrite"]]
      .forEach(([val,label])=>{
        const opt = h("option",{value:val},[label]);
        if (model.meta.projectStage===val) opt.selected=true;
        sel.appendChild(opt);
      });
    sel.addEventListener("change",(e)=>{ model.meta.projectStage=e.target.value; scheduleSave(); });
    stageWrap.appendChild(sel);
    stageWrap.appendChild(h("div",{class:"hint"},["Stage influences stakeholders, risks, and rollout."]));
    g.appendChild(stageWrap);
    root.appendChild(g);

    root.appendChild(fieldArea({
      label:"One-liner: what are you building and why?",
      value:model.meta.projectOneLiner,
      placeholder:"[who] does [what] so they can [benefit].",
      onInput:(v)=>{ model.meta.projectOneLiner=v; scheduleSave(); buildNav(); updateProgressUI(); }
    }));

    root.appendChild(fieldArea({
      label:"Primary users / beneficiaries",
      value:model.meta.users,
      placeholder:"Who uses it? Who benefits? Who might be affected indirectly?",
      onInput:(v)=>{ model.meta.users=v; scheduleSave(); buildNav(); updateProgressUI(); }
    }));

    root.appendChild(fieldArea({
      label:"Technical stack / environment",
      value:model.meta.stack,
      placeholder:"Languages, platforms, infra, dependencies, data sources, integrations…",
      onInput:(v)=>{ model.meta.stack=v; scheduleSave(); }
    }));

    root.appendChild(fieldArea({
      label:"Context & constraints",
      value:model.meta.constraints,
      placeholder:"Budget/time, deadlines, policies, performance, safety, compliance…",
      onInput:(v)=>{ model.meta.constraints=v; scheduleSave(); }
    }));

    root.appendChild(navButtons({prevLabel:"Back", nextLabel:"Answer Anticipation questions"}));
  }

  /** ---------- Step: Anticipation ---------- **/
  function qBlock({title, meta, tags, key, placeholder}) {
    const [section, field] = key;
    const block = h("div", { class:"qBlock" });
    block.appendChild(h("p",{class:"qTitle"},[title]));
    block.appendChild(h("p",{class:"qMeta"},[meta]));
    if (tags?.length) {
      const tr = h("div",{class:"tagRow"});
      tags.forEach(t => tr.appendChild(h("span",{class:"tag"},[t])));
      block.appendChild(tr);
    }
    block.appendChild(fieldArea({
      label:"Your notes",
      value:model[section][field],
      placeholder,
      onInput:(v)=>{ model[section][field]=v; scheduleSave(); buildNav(); updateProgressUI(); },
      minHeight:"120px"
    }));
    return block;
  }

  function renderAnticipation(root){
    const name = (model.meta.projectName || "your project").trim();
    root.appendChild(h("div",{class:"callout"},[
      h("div",{class:"small", html:
        `<strong>Anticipation:</strong> explore plausible impacts and failure modes for <b>${escapeHtml(name)}</b>.
         Your answers will be used to generate better AI prompts.`})
    ]));

    root.appendChild(qBlock({ title:"1) Intended outcomes",
      meta:"What good are you trying to create? How will you measure it?",
      tags:["benefits","metrics"],
      key:["anticipate","intendedOutcomes"],
      placeholder:"Positive outcomes + success measures."
    }));
    root.appendChild(qBlock({ title:"2) Stakeholders",
      meta:"Who is affected directly or indirectly? Who benefits vs. who bears costs?",
      tags:["stakeholders","power"],
      key:["anticipate","stakeholders"],
      placeholder:"List roles/groups; include non-users."
    }));
    root.appendChild(qBlock({ title:"3) Impacts & second-order effects",
      meta:"What might change over months/years if it succeeds or scales?",
      tags:["system effects","incentives"],
      key:["anticipate","impacts"],
      placeholder:"Downstream effects, behavior changes, organizational shifts."
    }));
    root.appendChild(qBlock({ title:"4) Failure modes & harm scenarios",
      meta:"Reliability, outages, dependency failures, user error — worst plausible harms?",
      tags:["failure","harm","resilience"],
      key:["anticipate","risksFailures"],
      placeholder:"List failure modes + plausible harms + rough likelihood."
    }));
    root.appendChild(qBlock({ title:"5) Misuse / abuse cases",
      meta:"If someone wanted to exploit this, how could they?",
      tags:["threat model","abuse"],
      key:["anticipate","misuseAbuse"],
      placeholder:"Abuse/misuse scenarios (insiders, attackers, gaming incentives...)."
    }));
    root.appendChild(qBlock({ title:"6) Data, privacy & security",
      meta:"What data is collected/derived? Retention? Leakage? Attack surfaces?",
      tags:["privacy","security","data lifecycle"],
      key:["anticipate","dataPrivacySecurity"],
      placeholder:"Data flow, sensitive data, key risks, security posture, mitigations."
    }));
    root.appendChild(qBlock({ title:"7) Fairness, accessibility & inclusion",
      meta:"Who might be excluded or disproportionately impacted?",
      tags:["fairness","a11y"],
      key:["anticipate","fairnessInclusion"],
      placeholder:"Bias/exclusion risks + how you'll reduce them."
    }));
    root.appendChild(qBlock({ title:"8) Environmental & social considerations (if relevant)",
      meta:"Compute/energy, attention/behavioral impacts, community effects.",
      tags:["environment","social"],
      key:["anticipate","environmentalSocial"],
      placeholder:"Any material environmental/social impacts and levers to improve."
    }));
    root.appendChild(qBlock({ title:"9) Legal / regulatory / policy constraints (if relevant)",
      meta:"Note what must be verified with experts (don’t guess in high-stakes).",
      tags:["legal","policy"],
      key:["anticipate","legalRegulatory"],
      placeholder:"Likely constraints: privacy law, sector rules, licensing, org policies."
    }));
    root.appendChild(qBlock({ title:"10) Uncertainties & assumptions",
      meta:"What don't you know yet that matters?",
      tags:["assumptions","unknowns"],
      key:["anticipate","uncertaintiesAssumptions"],
      placeholder:"Assumptions + evidence needed to confirm/deny."
    }));
    root.appendChild(qBlock({ title:"11) Alternatives",
      meta:"Different ways to achieve the goal (including smaller/non-tech interventions).",
      tags:["alternatives","scope"],
      key:["anticipate","alternatives"],
      placeholder:"Other solutions; minimum viable intervention."
    }));
    root.appendChild(qBlock({ title:"12) Mitigations & safeguards",
      meta:"What will you actually implement to reduce risks?",
      tags:["mitigation","controls"],
      key:["anticipate","mitigations"],
      placeholder:"Guardrails, defaults, oversight, logging, rollout strategy..."
    }));
    root.appendChild(qBlock({ title:"13) Go / No-Go triggers",
      meta:"What would make you pause, redesign, or stop?",
      tags:["monitoring","red lines"],
      key:["anticipate","goNoGo"],
      placeholder:"Signals/thresholds that trigger changes; monitoring plan."
    }));

    const ratio = completionAnticipation();
    const msg = ratio >= 0.65
      ? "Good coverage — generate prompts next."
      : "Fill a bit more for best AI results (aim for 8–10 solid answers).";
    root.appendChild(h("div",{class:"callout"},[
      h("div",{class:"small", html:`<strong>Anticipation completeness:</strong> ${Math.round(ratio*100)}% • ${escapeHtml(msg)}`})
    ]));

    root.appendChild(navButtons({prevLabel:"Back", nextLabel:"Generate AI prompts"}));
  }

  /** ---------- Step: Prompts ---------- **/
  function projectBrief() {
    const m = model.meta, a = model.anticipate;
    // Keep this reasonably sized but information-rich.
    return [
      `PROJECT NAME: ${m.projectName || "—"}`,
      `STAGE: ${m.projectStage || "—"}`,
      `ONE-LINER: ${m.projectOneLiner || "—"}`,
      `PRIMARY USERS / BENEFICIARIES: ${m.users || "—"}`,
      `STACK / ENVIRONMENT: ${m.stack || "—"}`,
      `CONSTRAINTS / CONTEXT: ${m.constraints || "—"}`,
      ``,
      `ANTICIPATION NOTES`,
      `- Intended outcomes: ${a.intendedOutcomes || "—"}`,
      `- Stakeholders: ${a.stakeholders || "—"}`,
      `- Impacts & second-order: ${a.impacts || "—"}`,
      `- Failure modes & harms: ${a.risksFailures || "—"}`,
      `- Misuse/abuse cases: ${a.misuseAbuse || "—"}`,
      `- Data/privacy/security: ${a.dataPrivacySecurity || "—"}`,
      `- Fairness/a11y/inclusion: ${a.fairnessInclusion || "—"}`,
      `- Environmental/social: ${a.environmentalSocial || "—"}`,
      `- Legal/policy: ${a.legalRegulatory || "—"}`,
      `- Uncertainties/assumptions: ${a.uncertaintiesAssumptions || "—"}`,
      `- Alternatives: ${a.alternatives || "—"}`,
      `- Mitigations/safeguards: ${a.mitigations || "—"}`,
      `- Go/No-Go triggers: ${a.goNoGo || "—"}`
    ].join("\n");
  }

  function promptRefinement() {
    return [
`You are an expert product + software architect and a responsible-innovation reviewer.
Given the project brief below, recommend refinements to the project specification.

Requirements for your response:
1) Write an improved project specification with: scope, non-goals, personas, user journeys, functional requirements, non-functional requirements, and acceptance criteria.
2) Identify key risks (technical, security, privacy, safety, fairness/inclusion, misuse/abuse, operational, legal/policy) and propose concrete mitigations for each.
3) Point out missing information and ask me the minimum set of clarifying questions (max 12).
4) Provide a prioritized roadmap (Now / Next / Later) and a lightweight metrics + monitoring plan.
5) Keep recommendations realistic for the stated constraints.

PROJECT BRIEF
${projectBrief()}`
    ].join("\n");
  }

  function promptDiagram() {
    return [
`You are a systems thinker and technical communicator.
Using the project brief below, create a diagram of the project and its impacts.

Output format:
A) A Mermaid diagram (prefer flowchart or C4-ish boxes) that includes:
   - Users/stakeholders
   - Core components/services
   - Data stores and data flows (mark sensitive data)
   - External integrations/dependencies
   - Trust boundaries / threat surfaces
B) A second Mermaid diagram focused on impacts:
   - Intended outcomes
   - Unintended impacts / second-order effects
   - Failure modes & harm pathways
   - Misuse/abuse pathways
   - Safeguards/mitigations mapped to those pathways
C) A short legend + 8–12 bullet annotations explaining the diagram choices and where uncertainty is highest.

PROJECT BRIEF
${projectBrief()}`
    ].join("\n");
  }

  function promptInteractiveDemo() {
    return [
`You are a senior frontend engineer and educator.
Based on the project brief below, generate a SINGLE-FILE HTML page (no build tools, no external assets) that interactively illustrates how the project works.

Hard requirements:
- Output ONLY the code for a complete HTML file.
- Use vanilla HTML/CSS/JS (no frameworks).
- Include mock data inside the file.
- The demo must be interactive and explain itself (labels, inline help, example flows).
- Include at least 3 user scenarios or flows relevant to the primary users.
- Include at least 1 failure mode simulation and how a safeguard mitigates it (based on the brief).
- Keep the code readable with comments and clear functions.
- The UI should show: inputs → processing → outputs, and highlight data flows (including sensitive data, if any).
- Add a small “Assumptions” panel listing assumptions you had to make, based on uncertainties in the brief.

PROJECT BRIEF
${projectBrief()}`
    ].join("\n");
  }

  function allPromptsMarkdown() {
    const name = model.meta.projectName || "project";
    return [
`# Generated GenAI Prompts — ${name}

These prompts were generated from your AREA Anticipation reflection.

---

## Prompt 1 — Recommendations for refinements to the project specification

\`\`\`
${promptRefinement()}
\`\`\`

---

## Prompt 2 — Diagram of the project and its impacts

\`\`\`
${promptDiagram()}
\`\`\`

---

## Prompt 3 — Generate an interactive HTML/JavaScript program illustrating the project

\`\`\`
${promptInteractiveDemo()}
\`\`\`

Generated: ${new Date().toISOString()}
`
    ].join("\n");
  }

  async function copyText(text) {
    try {
      await navigator.clipboard.writeText(text);
      saveIndicator.textContent = "copied ✓";
      setTimeout(()=> saveIndicator.textContent = "saved", 900);
    } catch {
      alert("Copy failed (browser permission). Try downloading instead.");
    }
  }

  function fileSafe(name){ return name.replace(/[^\w\-\.]+/g, "_").slice(0, 80); }
  function downloadBlob(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 5000);
  }

  function renderPrompts(root){
    const name = (model.meta.projectName || "your project").trim();

    root.appendChild(h("div",{class:"callout"},[
      h("div",{class:"small", html:
        `<strong>Generated prompts:</strong> copy/paste these into your preferred AI model.
         They are tailored to <b>${escapeHtml(name)}</b> using your Anticipation answers.`})
    ]));

    const prompts = [
      { id:"refine", title:"Prompt 1 — Ask for refinements to the project specification", make: promptRefinement },
      { id:"diagram", title:"Prompt 2 — Ask for a diagram of the project and its impacts", make: promptDiagram },
      { id:"demo", title:"Prompt 3 — Ask for an interactive HTML/JS illustration program", make: promptInteractiveDemo }
    ];

    prompts.forEach(p => {
      const text = p.make();
      const block = h("div",{class:"qBlock"});
      block.appendChild(h("p",{class:"qTitle"},[p.title]));
      block.appendChild(h("div",{class:"btnGroup"},[
        h("button",{type:"button", onclick:()=>copyText(text)},["Copy prompt"]),
        h("button",{type:"button", onclick:()=>{
          const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
          downloadBlob(blob, fileSafe(`${model.meta.projectName || "project"}-${p.id}-prompt.txt`));
        }},["Download .txt"])
      ]));
      block.appendChild(h("div",{class:"promptBox"},[text]));
      root.appendChild(block);
    });

    root.appendChild(h("div",{class:"qBlock"},[
      h("p",{class:"qTitle"},["Download all prompts (Markdown)"]),
      h("div",{class:"btnGroup"},[
        h("button",{type:"button", class:"primary", onclick:()=>{
          const blob = new Blob([allPromptsMarkdown()], {type:"text/markdown;charset=utf-8"});
          downloadBlob(blob, fileSafe(`${model.meta.projectName || "project"}-genai-prompts.md`));
        }},["Download .md"]),
        h("button",{type:"button", onclick:()=>copyText(allPromptsMarkdown())},["Copy all as Markdown"])
      ]),
      h("div",{class:"foot"},[
        "If a prompt feels too long for your model, remove the least relevant Anticipation bullets or ask the model to summarize the brief first."
      ])
    ]));

    root.appendChild(navButtons({prevLabel:"Back", showNext:false}));
  }

  /** ---------- Render ---------- **/
  function render(){
    const step = steps[currentStepIndex];
    buildNav(); updateProgressUI();
    stepKicker.textContent = `Step ${currentStepIndex+1} of ${steps.length}`;
    stepTitle.textContent = step.title;
    stepBadge.textContent = step.badge;
    content.innerHTML = "";
    step.render(content);
    [...stepList.querySelectorAll(".stepBtn")].forEach((b,i)=>{
      if (i===currentStepIndex) b.setAttribute("aria-current","step");
      else b.removeAttribute("aria-current");
    });
  }

  $("#resetBtn").addEventListener("click",()=>{
    const ok = confirm("Reset all saved answers for this app?");
    if (!ok) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  });

  load();
  currentStepIndex = model.meta.projectName ? 1 : 0;
  render();
})();
</script>
</body>
</html>
